<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học: Chăn nuôi gà an toàn sinh học - Sổ tay nông dân</title>
    <link rel="stylesheet" href="styles/course-detail.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</head>
<body class="glass-theme">
    <header class="main-header">
        <div class="container">
            <a href="dash.html" class="logo"><i class="fas fa-seedling"></i> Sổ Tay Nông Dân</a>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
             <!-- NEW: Back to Dashboard Button -->
            <div class="back-button-wrapper">
                <a href="dash.html" class="nav-btn"><i class="fas fa-arrow-left"></i> Quay lại Bảng điều khiển</a>
            </div>

            <article id="course-container" class="course-article card">
                
                <!-- VIEW 1: COURSE OVERVIEW -->
                <div id="course-overview">
                     <header class="course-header">
                        <h1>Khóa học: Chăn nuôi gà an toàn sinh học</h1>
                        <div class="course-meta">
                            <span class="meta-item"><i class="fas fa-user-tie"></i> Chuyên gia: PGS.TS. Nguyễn Thị Minh</span>
                            <span class="meta-item"><i class="fas fa-layer-group"></i> Lĩnh vực: Chăn nuôi</span>
                            <span class="meta-item"><i class="fas fa-clock"></i> Thời lượng: 6 giờ</span>
                        </div>
                    </header>

                    <div class="course-image-container">
                        <img src="https://images.unsplash.com/photo-1587303213013-106c4a86a644?q=80&w=1974&auto=format&fit=crop" alt="Đàn gà khỏe mạnh trong trang trại">
                    </div>

                    <div class="course-body">
                        <p class="sapo">
                            Trang bị kiến thức và kỹ năng thực hành chăn nuôi gà theo hướng an toàn sinh học, giúp phòng chống dịch bệnh hiệu quả, nâng cao chất lượng sản phẩm và tối đa hóa lợi nhuận.
                        </p>
                        
                        <div class="progress-tracker">
                            <h3>Tiến độ khóa học</h3>
                            <div class="progress-bar-container">
                                <div id="course-progress-bar" class="progress-bar"></div>
                            </div>
                            <span id="progress-text">0/4 chương hoàn thành</span>
                        </div>

                        <h2>Nội dung khóa học</h2>
                        <div id="accordion-container" class="accordion">
                            <!-- Accordion items will be generated by JS -->
                        </div>
                        
                        <div id="login-prompt-container" class="view-hidden" style="text-align: center; margin-top: 20px;">
                            <p><a href="login.html">Đăng nhập</a> để theo dõi tiến độ học tập của bạn.</p>
                        </div>

                        <div class="quiz-cta card">
                            <h3>Kiểm tra kiến thức của bạn!</h3>
                            <p>Bài kiểm tra cho khóa học này đang được phát triển. Vui lòng quay lại sau!</p>
                            <button class="btn btn-primary disabled" disabled>Bài kiểm tra sắp ra mắt</button>
                        </div>
                    </div>
                </div>

                <!-- VIEW 2: LESSON VIEW (Initially Hidden) -->
                <div id="lesson-view" class="view-hidden">
                    <div class="lesson-breadcrumb">
                         <button id="back-to-overview-btn">Tổng quan khóa học</button> > <span id="breadcrumb-chapter"></span> > <span id="breadcrumb-lesson"></span>
                    </div>
                    <h2 id="lesson-title"></h2>
                    <div id="lesson-content"></div>
                    <div class="lesson-navigation">
                        <button id="mark-lesson-complete" class="btn">
                            <i class="fas fa-check"></i>
                            <i class="fas fa-circle-notch"></i>
                            <span>Đánh dấu đã học xong</span>
                        </button>
                        <div class="nav-buttons">
                            <button id="prev-lesson-btn" class="btn btn-secondary btn-lesson-nav"><i class="fas fa-arrow-left"></i> Bài trước</button>
                            <button id="next-lesson-btn" class="btn btn-primary btn-lesson-nav">Bài tiếp theo <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                </div>

            </article>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 Sổ tay nông dân thông minh. Mọi quyền được bảo lưu.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DATA ---
            const courseId = 'chicken-course-v1';
            const courseData = [
                {
                    title: "Thiết kế và xây dựng chuồng trại",
                    lessons: [
                        { id: 'c0l0', title: "Lựa chọn địa điểm và hướng chuồng", content: "<h3>Địa điểm lý tưởng:</h3><p>Cần chọn nơi cao ráo, thoát nước tốt, xa khu dân cư và nguồn ô nhiễm. Lý tưởng nhất là có cây xanh che mát xung quanh.</p><h3>Hướng chuồng:</h3><p>Nên chọn hướng Nam hoặc Đông Nam để đón gió mát vào mùa hè và tránh gió lạnh vào mùa đông, đồng thời nhận được ánh sáng mặt trời vừa đủ.</p>" },
                        { id: 'c0l1', title: "Vật liệu và kết cấu chuồng trại", content: "<h3>Nền chuồng:</h3><p>Nền xi măng hoặc bê tông có độ dốc 2-3% để dễ dàng vệ sinh, thoát nước. Phủ trên là lớp đệm lót sinh học (trấu, mùn cưa).</p><h3>Mái chuồng:</h3><p>Sử dụng các vật liệu cách nhiệt tốt như tôn lạnh, mái lá, hoặc pro-xi măng. Chiều cao mái phù hợp để đảm bảo thông thoáng.</p><h3>Tường chuồng:</h3><p>Xây cao khoảng 40-50cm, phần trên dùng lưới B40 hoặc rèm bạt để điều chỉnh độ thông thoáng.</p>" },
                        { id: 'c0l2', title: "Đệm lót sinh học", content: "<h3>Lợi ích:</h3><ul><li>Phân giải phân, giảm mùi hôi.</li><li>Tạo nhiệt sưởi ấm cho gà vào mùa đông.</li><li>Hạn chế bệnh tật về đường hô hấp và tiêu hóa.</li><li>Tiết kiệm công dọn chuồng.</li></ul><h3>Cách làm:</h3><p>Rải một lớp trấu hoặc mùn cưa dày 10-15cm, sau đó phun đều chế phẩm men vi sinh Balasa N01 hoặc tương tự và giữ ẩm.</p>" }
                    ]
                },
                {
                    title: "Chọn giống và kỹ thuật úm gà con",
                    lessons: [
                        { id: 'c1l0', title: "Đặc điểm các giống gà phổ biến", content: "Nội dung đang được cập nhật..." },
                        { id: 'c1l1', title: "Chuẩn bị quây úm và dụng cụ", content: "Nội dung đang được cập nhật..." },
                        { id: 'c1l2', title: "Chăm sóc gà con giai đoạn úm", content: "Nội dung đang được cập nhật..." }
                    ]
                },
                {
                    title: "Dinh dưỡng và thức ăn",
                    lessons: [
                         { id: 'c2l0', title: "Nhu cầu năng lượng, protein, vitamin", content: "Nội dung đang được cập nhật..." },
                         { id: 'c2l1', title: "Tự phối trộn thức ăn", content: "Nội dung đang được cập nhật..." },
                         { id: 'c2l2', title: "Quản lý nước uống và máng ăn", content: "Nội dung đang được cập nhật..." }
                    ]
                },
                {
                    title: "Quy trình thú y và an toàn sinh học",
                    lessons: [
                        { id: 'c3l0', title: "Nhận biết các bệnh thường gặp", content: "Nội dung đang được cập nhật..." },
                        { id: 'c3l1', title: "Xây dựng lịch vắc-xin chi tiết", content: "Nội dung đang được cập nhật..." },
                        { id: 'c3l2', title: "Thực hành quy trình 'cùng vào, cùng ra'", content: "Nội dung đang được cập nhật..." }
                    ]
                }
            ];

            // --- DOM ELEMENTS, STATE, FUNCTIONS (Same as rice course) ---
            const courseContainer = document.getElementById('course-container');
            const overviewView = document.getElementById('course-overview');
            const lessonView = document.getElementById('lesson-view');
            const accordionContainer = document.getElementById('accordion-container');
            const progressBar = document.getElementById('course-progress-bar');
            const progressText = document.getElementById('progress-text');
            const loginPromptContainer = document.getElementById('login-prompt-container');
            const backToOverviewBtn = document.getElementById('back-to-overview-btn');
            const lessonTitle = document.getElementById('lesson-title');
            const lessonContent = document.getElementById('lesson-content');
            const markLessonCompleteBtn = document.getElementById('mark-lesson-complete');
            const prevLessonBtn = document.getElementById('prev-lesson-btn');
            const nextLessonBtn = document.getElementById('next-lesson-btn');
            const breadcrumbChapter = document.getElementById('breadcrumb-chapter');
            const breadcrumbLesson = document.getElementById('breadcrumb-lesson');

            let currentUser = null;
            let progressData = {};
            let currentChapterIndex = -1;
            let currentLessonIndex = -1;

            function saveData() {
                if (!currentUser) return;
                localStorage.setItem(`${courseId}_${currentUser.id}_progress`, JSON.stringify(progressData));
            }

            function loadData() {
                const userData = localStorage.getItem("currentUser");
                if (userData) {
                    currentUser = JSON.parse(userData);
                    const savedProgress = localStorage.getItem(`${courseId}_${currentUser.id}_progress`);
                    if (savedProgress) {
                        progressData = JSON.parse(savedProgress);
                    }
                }
            }

            function renderOverview() {
                overviewView.classList.remove('view-hidden');
                lessonView.classList.add('view-hidden');
                
                accordionContainer.innerHTML = '';
                let completedChapters = 0;

                courseData.forEach((chapter, chapterIndex) => {
                    const lessonsInChapter = chapter.lessons;
                    let lessonsHTML = '<ul>';
                    let completedLessonsInChapter = 0;

                    lessonsInChapter.forEach(lesson => {
                        const isCompleted = progressData[lesson.id] === true;
                        if (isCompleted) completedLessonsInChapter++;
                        lessonsHTML += `
                            <li>
                                <span>${lesson.title}</span>
                                <i class="fas ${isCompleted ? 'fa-check-circle' : 'fa-circle'} lesson-status-icon ${isCompleted ? 'completed' : ''}"></i>
                            </li>`;
                    });
                    lessonsHTML += '</ul>';

                    if (completedLessonsInChapter === lessonsInChapter.length && lessonsInChapter.length > 0) {
                        completedChapters++;
                    }

                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'accordion-item';
                    accordionItem.innerHTML = `
                        <button class="accordion-header">
                            <span>Chương ${chapterIndex + 1}: ${chapter.title}</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="content-inner">
                                ${lessonsHTML}
                                <div class="btn-start-chapter">
                                    <button class="btn btn-secondary btn-start" data-chapter="${chapterIndex}">Bắt đầu chương học</button>
                                </div>
                            </div>
                        </div>`;
                    accordionContainer.appendChild(accordionItem);
                });

                const totalChapters = courseData.length;
                const progressPercentage = totalChapters > 0 ? (completedChapters / totalChapters) * 100 : 0;
                progressBar.style.width = `${progressPercentage}%`;
                progressText.textContent = `${completedChapters}/${totalChapters} chương hoàn thành`;
                
                loginPromptContainer.classList.toggle('view-hidden', !!currentUser);

                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        header.classList.toggle('active');
                        content.style.maxHeight = header.classList.contains('active') ? content.scrollHeight + "px" : null;
                    });
                });

                document.querySelectorAll('.btn-start').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const chapterIndex = parseInt(e.target.dataset.chapter);
                        startChapter(chapterIndex);
                    });
                });
            }

            function renderLesson(chapterIndex, lessonIndex) {
                currentChapterIndex = chapterIndex;
                currentLessonIndex = lessonIndex;

                overviewView.classList.add('view-hidden');
                lessonView.classList.remove('view-hidden');
                
                const chapter = courseData[chapterIndex];
                const lesson = chapter.lessons[lessonIndex];
                
                breadcrumbChapter.textContent = `Chương ${chapterIndex + 1}`;
                breadcrumbLesson.textContent = lesson.title;

                lessonTitle.textContent = lesson.title;
                lessonContent.innerHTML = lesson.content || "<p>Nội dung đang được cập nhật.</p>";
                
                const isCompleted = progressData[lesson.id] === true;
                markLessonCompleteBtn.classList.toggle('completed', isCompleted);
                markLessonCompleteBtn.querySelector('span').textContent = isCompleted ? 'Đã hoàn thành' : 'Đánh dấu đã học xong';
                markLessonCompleteBtn.disabled = !currentUser;

                prevLessonBtn.disabled = (chapterIndex === 0 && lessonIndex === 0);
                
                const isLastLessonInCourse = (chapterIndex === courseData.length - 1 && lessonIndex === chapter.lessons.length - 1);
                nextLessonBtn.disabled = isLastLessonInCourse;
                if (lessonIndex === chapter.lessons.length - 1) {
                    nextLessonBtn.innerHTML = 'Chương tiếp theo <i class="fas fa-arrow-right"></i>';
                } else {
                    nextLessonBtn.innerHTML = 'Bài tiếp theo <i class="fas fa-arrow-right"></i>';
                }

                window.scrollTo(0, 0);
            }
            
            function startChapter(chapterIndex) {
                if(courseData[chapterIndex] && courseData[chapterIndex].lessons.length > 0) {
                    renderLesson(chapterIndex, 0);
                } else {
                    alert('Chương này hiện chưa có bài học.');
                }
            }
            
            function handleMarkComplete() {
                if (!currentUser) {
                    alert('Vui lòng đăng nhập để lưu tiến độ.');
                    return;
                }
                const lesson = courseData[currentChapterIndex].lessons[currentLessonIndex];
                progressData[lesson.id] = true;
                saveData();
                renderLesson(currentChapterIndex, currentLessonIndex);
            }

            function handleNavigation(direction) {
                let nextLesson = currentLessonIndex;
                let nextChapter = currentChapterIndex;

                if (direction === 'next') {
                    if (currentLessonIndex < courseData[currentChapterIndex].lessons.length - 1) {
                        nextLesson++;
                    } else if (currentChapterIndex < courseData.length - 1) {
                        nextChapter++;
                        nextLesson = 0;
                    }
                } else if (direction === 'prev') {
                    if (currentLessonIndex > 0) {
                        nextLesson--;
                    } else if (currentChapterIndex > 0) {
                        nextChapter--;
                        nextLesson = courseData[nextChapter].lessons.length - 1;
                    }
                }
                renderLesson(nextChapter, nextLesson);
            }

            backToOverviewBtn.addEventListener('click', renderOverview);
            markLessonCompleteBtn.addEventListener('click', handleMarkComplete);
            prevLessonBtn.addEventListener('click', () => handleNavigation('prev'));
            nextLessonBtn.addEventListener('click', () => handleNavigation('next'));

            function init() {
                loadData();
                renderOverview();
            }

            init();
        });
    </script>
</body>
</html>
